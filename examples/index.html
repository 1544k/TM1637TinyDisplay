<!-- 
    7-Segment LED Display Animator 
    by Jason A Cox - @jasonacox

    Date: 1 July 2020
-->
<html>
<head>
<style>
#digitPane {
  background-color: black;
  width: 600px;
  text-align: center;
}
.off {
  fill: #320000;
}
.on {
  fill: red;
}
#readings {
    display: inline-block; 
    width: 120px; 
    margin-left: 20px;
}
#valuePane {
    width: 800px;
    margin-left: 20px;
}
#codeOutput {
    height:100px;
    width:600px;
    margin-top: 20px;
    border:1px solid #4e4e4e;
    font:16px Arial, Serif;
    overflow:auto;
}
#controls {
    display: inline-block; 
    width: 600; 
    margin-left: 20px;
}
  /* Set up 7-segment LED Binary Data

    |--A--|
    F     B
    |--G--|
    E     C
    |--D--|
           H - Decimal

    HGFEDCBA
  0b00000000
*/

</style>
	</head>
	<body>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	
		<h1>7-Segment LED Display Animator</h1>

<div id="digitPane">
    <svg xmlns="http://www.w3.org/2000/svg" width="140px" height="200px" viewBox="2 -2 10 22">
        <g class="digit1">
          <polygon id="a" class="off" points=" 1, 1  2, 0  8, 0  9, 1  8, 2  2, 2"/>
          <polygon id="b" class="off" points=" 9, 1 10, 2 10, 8  9, 9  8, 8  8, 2"/>
          <polygon id="c" class="off" points=" 9, 9 10,10 10,16  9,17  8,16  8,10"/>
          <polygon id="d" class="off" points=" 9,17  8,18  2,18  1,17  2,16  8,16"/>
          <polygon id="e" class="off" points=" 1,17  0,16  0,10  1, 9  2,10  2,16"/>
          <polygon id="f" class="off" points=" 1, 9  0, 8  0, 2  1, 1  2, 2  2, 8"/>
          <polygon id="g" class="off" points=" 1, 9  2, 8  8, 8  9, 9  8,10  2,10"/>
          <polygon id="h" class="off" points=" 11,16  13,16  13,18  11,18"/>
        </g>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" width="140px" height="200px" viewBox="2 -2 10 22">
        <g class="digit2">
          <polygon id="a" class="off" points=" 1, 1  2, 0  8, 0  9, 1  8, 2  2, 2"/>
          <polygon id="b" class="off" points=" 9, 1 10, 2 10, 8  9, 9  8, 8  8, 2"/>
          <polygon id="c" class="off" points=" 9, 9 10,10 10,16  9,17  8,16  8,10"/>
          <polygon id="d" class="off" points=" 9,17  8,18  2,18  1,17  2,16  8,16"/>
          <polygon id="e" class="off" points=" 1,17  0,16  0,10  1, 9  2,10  2,16"/>
          <polygon id="f" class="off" points=" 1, 9  0, 8  0, 2  1, 1  2, 2  2, 8"/>
          <polygon id="g" class="off" points=" 1, 9  2, 8  8, 8  9, 9  8,10  2,10"/>
          <polygon id="h" class="off" points=" 11,16  13,16  13,18  11,18"/>
        </g>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" width="140px" height="200px" viewBox="2 -2 10 22">
        <g class="digit3">
          <polygon id="a" class="off" points=" 1, 1  2, 0  8, 0  9, 1  8, 2  2, 2"/>
          <polygon id="b" class="off" points=" 9, 1 10, 2 10, 8  9, 9  8, 8  8, 2"/>
          <polygon id="c" class="off" points=" 9, 9 10,10 10,16  9,17  8,16  8,10"/>
          <polygon id="d" class="off" points=" 9,17  8,18  2,18  1,17  2,16  8,16"/>
          <polygon id="e" class="off" points=" 1,17  0,16  0,10  1, 9  2,10  2,16"/>
          <polygon id="f" class="off" points=" 1, 9  0, 8  0, 2  1, 1  2, 2  2, 8"/>
          <polygon id="g" class="off" points=" 1, 9  2, 8  8, 8  9, 9  8,10  2,10"/>
          <polygon id="h" class="off" points=" 11,16  13,16  13,18  11,18"/>
        </g>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" width="140px" height="200px" viewBox="2 -2 10 22">
        <g class="digit4">
          <polygon id="a" class="off" points=" 1, 1  2, 0  8, 0  9, 1  8, 2  2, 2"/>
          <polygon id="b" class="off" points=" 9, 1 10, 2 10, 8  9, 9  8, 8  8, 2"/>
          <polygon id="c" class="off" points=" 9, 9 10,10 10,16  9,17  8,16  8,10"/>
          <polygon id="d" class="off" points=" 9,17  8,18  2,18  1,17  2,16  8,16"/>
          <polygon id="e" class="off" points=" 1,17  0,16  0,10  1, 9  2,10  2,16"/>
          <polygon id="f" class="off" points=" 1, 9  0, 8  0, 2  1, 1  2, 2  2, 8"/>
          <polygon id="g" class="off" points=" 1, 9  2, 8  8, 8  9, 9  8,10  2,10"/>
          <polygon id="h" class="off" points=" 11,16  13,16  13,18  11,18"/>
        </g>
    </svg>
</div>
<div id="valuePane">
    <div id="readings">
        <p id="val1">Digit 1</p>
        <p id="hex1">HEX</p>
        <p id="bin1">BIN</p>
    </div>
    <div id="readings">
        <p id="val2">Digit 2</p>
        <p id="hex2">HEX</p>
        <p id="bin2">BIN</p>
    </div>
    <div id="readings">
        <p id="val3">Digit 3</p>
        <p id="hex3">HEX</p>
        <p id="bin3">BIN</p>
    </div>
    <div id="readings">
        <p id="val4">Digit 4</p>
        <p id="hex4">HEX</p>
        <p id="bin4">BIN</p>
    </div>
</div>

<br>
<br>
<div>
    Click segments to turn on/off and click "Save" to record frame.
    <div id="controls">
        <button onclick="saveFrame()">Save Frame</button>
        <button onclick="playAnimation()">Playback Animation</button>
        <button onclick="clearDisplays()">Clear Displays</button>
        <p id="frame">Frame 0</p>
    </div>
</div>

<pre id="codeOutput" contentEditable="true">
{ 0x00, 0x00, 0x00, 0x00 },  // Frame 0</pre>

<script>

    function grabValue(dig) { 
        // Compute binary value based on segment LEDs
        var digitbin = 0;
        if($(dig.concat(" #a")).attr("class") == "on") digitbin += 0b00000001;
        if($(dig.concat(" #b")).attr("class") == "on") digitbin += 0b00000010;
        if($(dig.concat(" #c")).attr("class") == "on") digitbin += 0b00000100;
        if($(dig.concat(" #d")).attr("class") == "on") digitbin += 0b00001000;
        if($(dig.concat(" #e")).attr("class") == "on") digitbin += 0b00010000;
        if($(dig.concat(" #f")).attr("class") == "on") digitbin += 0b00100000;
        if($(dig.concat(" #g")).attr("class") == "on") digitbin += 0b01000000;
        if($(dig.concat(" #h")).attr("class") == "on") digitbin += 0b10000000;
        return(digitbin);
    }
    function clearDisplays(){
        resetZero(".digit1")
        resetZero(".digit2")
        resetZero(".digit3")
        resetZero(".digit4")
     
    }
    function resetZero(dig) {
        $(dig.concat(" #a")).attr("class","off");
        $(dig.concat(" #b")).attr("class","off");
        $(dig.concat(" #c")).attr("class","off");
        $(dig.concat(" #d")).attr("class","off");
        $(dig.concat(" #e")).attr("class","off");
        $(dig.concat(" #f")).attr("class","off");
        $(dig.concat(" #g")).attr("class","off");
        $(dig.concat(" #h")).attr("class","off");
    }

    function setDigits(dig, digitbin) { 
        // Set segment LEDs based on digitbin
        resetZero(dig);
       // alert("info: ".concat(dig," - ",digitbin));
        if(digitbin & 0b00000001 > 0) 
            $(dig.concat(" #a")).attr("class","on");
        if(digitbin & 0b00000010> 0) 
            $(dig.concat(" #b")).attr("class","on");
        if(digitbin & 0b00000100 > 0) 
            $(dig.concat(" #c")).attr("class","on");
        if(digitbin & 0b00001000 > 0) 
            $(dig.concat(" #d")).attr("class","on");
        if(digitbin & 0b00010000 > 0) 
            $(dig.concat(" #e")).attr("class","on");
        if(digitbin & 0b00100000 > 0) 
            $(dig.concat(" #f")).attr("class","on");
        if(digitbin & 0b01000000 > 0) 
            $(dig.concat(" #g")).attr("class","on");
        if(digitbin & 0b10000000 > 0) 
            $(dig.concat(" #h")).attr("class","on");
    }

    function updateValues() {
        // Compute digit values and display
        digit1bin = grabValue(".digit1");
        $('#hex1').html('0x'.concat(digit1bin.toString(16).padStart(2, '0')));    
        $('#bin1').html('0b'.concat(digit1bin.toString(2).padStart(8, '0')));  
        digit2bin = grabValue(".digit2");
        $('#hex2').html('0x'.concat(digit2bin.toString(16).padStart(2, '0')));    
        $('#bin2').html('0b'.concat(digit2bin.toString(2).padStart(8, '0')));  
        digit3bin = grabValue(".digit3");
        $('#hex3').html('0x'.concat(digit3bin.toString(16).padStart(2, '0')));    
        $('#bin3').html('0b'.concat(digit3bin.toString(2).padStart(8, '0')));  
        digit4bin = grabValue(".digit4");
        $('#hex4').html('0x'.concat(digit4bin.toString(16).padStart(2, '0')));    
        $('#bin4').html('0b'.concat(digit4bin.toString(2).padStart(8, '0')));           
    }
    function saveFrame() {
        d1 = '0x'.concat(grabValue(".digit1").toString(16).padStart(2, '0'));
        d2 = '0x'.concat(grabValue(".digit2").toString(16).padStart(2, '0'));
        d3 = '0x'.concat(grabValue(".digit3").toString(16).padStart(2, '0'));
        d4 = '0x'.concat(grabValue(".digit4").toString(16).padStart(2, '0'));
        var output = $('#codeOutput').text();
        $('#codeOutput').text(''.concat(output,"\n{ ",d1,", ",d2,", ",d3,", ",d4," },  // frame"));
    }
    function playAnimation() {
        var frame = 0;
        var lines = $('#codeOutput').text().split("\n");
        lines.forEach(function(line) {
            $('#frame').text("Frame = ".concat(frame.toString()));
            var fields = line.replace("{","").replace("}","").split(",");
            d1 = parseInt(fields[0].trim());
            d2 = parseInt(fields[1].trim());
            d3 = parseInt(fields[2].trim());
            d4 = parseInt(fields[3].trim());
            setDigits(".digit1", d1)
            setDigits(".digit2", d2)
            setDigits(".digit3", d3)
            setDigits(".digit4", d4)
            /*
            fields.forEach(function(digit) {
                alert(digit);
                var d = parseInt(digit.trim());
            })
            */
           frame++;

        })
    }

    $(document).ready(function() {
        $(".digit1 polygon").click(function() {
            //$(this).toggleClass("on");        
            var sSegClass = $(this).attr("class") === "off" ? "on" : "off";            
            $(this).attr("class", sSegClass);
            // var seg = ($(this).attr('id'));
            //$('#val1').text(seg);
            updateValues();        
        });
        $(".digit2 polygon").click(function() {
            //$(this).toggleClass("on");        
            var sSegClass = $(this).attr("class") === "off" ? "on" : "off";            
            $(this).attr("class", sSegClass);
            updateValues();  
        });
        $(".digit3 polygon").click(function() {
            //$(this).toggleClass("on");        
            var sSegClass = $(this).attr("class") === "off" ? "on" : "off";            
            $(this).attr("class", sSegClass);
            updateValues();  
        });
        $(".digit4 polygon").click(function() {
            //$(this).toggleClass("on");        
            var sSegClass = $(this).attr("class") === "off" ? "on" : "off";            
            $(this).attr("class", sSegClass);
            updateValues();  
        }); 
    });

    updateValues();
        </script>
	</body>
</html>
